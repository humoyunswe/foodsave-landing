export type CtaHandlers = {
  openAppStore: () => void;
  openGooglePlay: () => void;
  openAppGallery: () => void;
  openBusinessRegistration: () => void;
  openExternal: (url: string) => void;
  scrollToId: (id: string) => void;
  scrollToTop: () => void;
};

// Simple feature-detection for reduced motion
function prefersReducedMotion(): boolean {
  if (typeof window === 'undefined' || !('matchMedia' in window)) return false;
  try {
    return window.matchMedia('(prefers-reduced-motion: reduce)').matches;
  } catch {
    return false;
  }
}

function openInNewTab(url: string) {
  try {
    window.open(url, '_blank', 'noopener,noreferrer');
  } catch {
    // noop
  }
}

export function useCTAs(): CtaHandlers {
  // Mock store links (replace later)
  const APP_STORE = 'https://apps.apple.com/app/id0000000000';
  const GOOGLE_PLAY = 'https://play.google.com/store/apps/details?id=com.mock.foodsave';
  const APP_GALLERY = 'https://appgallery.huawei.com/app/C000000000';
  const BIZ_MAILTO = 'mailto:partners@foodsave.uz?subject=%D0%A0%D0%B5%D0%B3%D0%B8%D1%81%D1%82%D1%80%D0%B0%D1%86%D0%B8%D1%8F%20%D0%B1%D0%B8%D0%B7%D0%BD%D0%B5%D1%81%D0%B0';

  const openExternal = (url: string) => openInNewTab(url);

  const scrollToId = (id: string) => {
    const el = document.getElementById(id);
    if (!el) return;
    try {
      el.scrollIntoView({ behavior: prefersReducedMotion() ? 'auto' : 'smooth', block: 'start' });
    } catch {
      el.scrollIntoView();
    }
  };

  const scrollToTop = () => {
    try {
      window.scrollTo({ top: 0, behavior: prefersReducedMotion() ? 'auto' : 'smooth' });
    } catch {
      window.scrollTo(0, 0);
    }
  };

  return {
    openAppStore: () => openExternal(APP_STORE),
    openGooglePlay: () => openExternal(GOOGLE_PLAY),
    openAppGallery: () => openExternal(APP_GALLERY),
    openBusinessRegistration: () => openExternal(BIZ_MAILTO),
    openExternal,
    scrollToId,
    scrollToTop,
  };
} 